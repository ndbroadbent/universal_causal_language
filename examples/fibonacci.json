{
  "metadata": {
    "domain": "programming",
    "description": "Calculate Fibonacci numbers using recursive function - demonstrates Turing completeness",
    "target": "ruby"
  },
  "actions": [
    {
      "actor": "VM",
      "op": "DefineFunction",
      "target": "fibonacci",
      "params": {
        "args": ["n"],
        "body": [
          {
            "actor": "VM",
            "op": "If",
            "target": "base_case",
            "condition": {
              "type": "comparison",
              "op": "<=",
              "left": {"var": "n"},
              "right": 1
            },
            "then": [
              {
                "actor": "VM",
                "op": "Return",
                "target": "result",
                "params": {
                  "value": {"var": "n"}
                }
              }
            ],
            "else": [
              {
                "actor": "VM",
                "op": "Return",
                "target": "result",
                "params": {
                  "value": {
                    "expr": {
                      "op": "+",
                      "left": {
                        "call": "fibonacci",
                        "args": {
                          "n": {
                            "expr": {
                              "op": "-",
                              "left": {"var": "n"},
                              "right": 1
                            }
                          }
                        }
                      },
                      "right": {
                        "call": "fibonacci",
                        "args": {
                          "n": {
                            "expr": {
                              "op": "-",
                              "left": {"var": "n"},
                              "right": 2
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            ]
          }
        ]
      }
    },
    {
      "actor": "VM",
      "op": "Emit",
      "target": "header",
      "params": {
        "content": "Fibonacci sequence:"
      }
    },
    {
      "actor": "VM",
      "op": "For",
      "target": "loop",
      "variable": "i",
      "from": 0,
      "to": 10,
      "body": [
        {
          "actor": "VM",
          "op": "Bind",
          "target": "result",
          "params": {
            "value": {
              "call": "fibonacci",
              "args": {
                "n": {"var": "i"}
              }
            }
          }
        },
        {
          "actor": "VM",
          "op": "Emit",
          "target": "output",
          "params": {
            "content": {"var": "result"}
          }
        }
      ]
    }
  ]
}
